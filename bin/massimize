#!/usr/bin/env coffee

fs        = require "fs"
massimize = require ".."

convert = (recipe) ->
  process.stdout.write massimize(recipe)

switch process.argv.length
  when 2
    process.stdin.resume()
    process.stdin.setEncoding('utf8')
    parts = []
    process.stdin.on 'data', part ->
      parts.push part
    process.stdin.on 'end', ->
      convert parts.join('')
  when 3
    if process.argv[2] in ['-h', '--help']
      console.log "Usage: massimizer [file | recipe]"
      process.exit 0
    else
      recipe = try
          fs.readFileSync(process.argv[2], "utf8")
        catch error
          console.log "massimizer: #{error.message}"
          process.exit 1
      convert recipe
  else
    convert process.argv[2..].join(' ') + "\n"
